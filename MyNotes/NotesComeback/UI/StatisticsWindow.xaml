<Window x:Class="UI.StatisticsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        MouseLeftButtonDown="Window_MouseLeftButtonDown"
        MinHeight="640" MinWidth="800"
        Background="Transparent"
        WindowStyle="None"
        AllowsTransparency="True"
        WindowStartupLocation="CenterOwner">

    <Border Background="GhostWhite" 
            CornerRadius="20" 
            BorderBrush="#CCCCCC"
            BorderThickness="1"
            Margin="10">

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Заголовок и кнопка закрытия -->
            <Grid Grid.Row="0" Margin="20,15,20,10">
                <TextBlock Text="Статистика заметок" 
                           FontSize="24" 
                           FontWeight="Bold" 
                           Foreground="Black"
                           HorizontalAlignment="Center"/>

                <Button Width="24" Height="24" 
                        Click="CloseButton_Click" 
                        Background="LightGray" 
                        BorderBrush="Transparent" 
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Grid>
                                <Ellipse Fill="{TemplateBinding Background}"/>
                                <Viewbox>
                                    <Canvas Width="32" Height="32">
                                        <Path Stroke="White" StrokeThickness="3" Data="M 8,8 L 24,24 M 24,8 L 8,24"/>
                                    </Canvas>
                                </Viewbox>
                            </Grid>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>

            <!-- Вкладки -->
            <Border Grid.Row="1" 
                    Background="#F8F8F8" 
                    CornerRadius="15,15,0,0"
                    Margin="20,0,20,0"
                    Padding="1">

                <TabControl x:Name="StatsTabs" 
                            Background="White"
                            BorderThickness="0">

                    <TabControl.Resources>
                        <Style TargetType="TabItem">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="TabItem">
                                        <Border Name="Border" 
                                                Background="LightGray" 
                                                BorderBrush="#DDD" 
                                                BorderThickness="1,1,1,0"
                                                CornerRadius="8,8,0,0"
                                                Margin="2,2,2,0"
                                                Padding="15,8">
                                            <ContentPresenter x:Name="ContentSite"
                                                              VerticalAlignment="Center"
                                                              HorizontalAlignment="Center"
                                                              ContentSource="Header"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="Border" Property="Background" Value="white"/>
                                                <Setter TargetName="Border" Property="BorderBrush" Value="#CCCCCC"/>
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TabControl.Resources>

                    <!-- ВКЛАДКА 1 — ПО МЕСЯЦАМ -->
                    <TabItem Header="По месяцам">
                        <!-- Добавляем ScrollViewer для всей вкладки -->
                        <ScrollViewer VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled"
                                      Padding="0">
                            <Grid Margin="12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <!-- Изменено с * на Auto -->
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- 1) Статистика -->
                                <StackPanel Orientation="Vertical" Grid.Row="0" Margin="0,0,0,15">
                                    <TextBlock Text="Распределение заметок по месяцам"
                                           FontSize="18" 
                                           FontWeight="Bold" 
                                           HorizontalAlignment="Center" />
                                    <StackPanel Orientation="Horizontal" 
                                                HorizontalAlignment="Center" 
                                                Margin="0,8,0,0">
                                        <Border Background="#F0F0F0" 
                                                CornerRadius="8" 
                                                Padding="12,6"
                                                Margin="0,0,10,0">
                                            <TextBlock x:Name="NotesCountTextBlock" 
                                                       Text="Заметок: 0"
                                                       FontSize="14"
                                                       FontWeight="Medium"/>
                                        </Border>
                                        <Border Background="#F0F0F0" 
                                                CornerRadius="8" 
                                                Padding="12,6">
                                            <TextBlock x:Name="CategoriesCountTextBlock" 
                                                       Text="Категорий: 0"
                                                       FontSize="14"
                                                       FontWeight="Medium"/>
                                        </Border>
                                    </StackPanel>
                                </StackPanel>

                                <!-- 2) ПАНЕЛЬ ФИЛЬТРОВ -->
                                <StackPanel Grid.Row="1" Margin="0,5,0,15">
                                    <Border Background="#F0F0F0"
                                        Padding="15"
                                        CornerRadius="12"
                                        BorderBrush="#DDD"
                                        BorderThickness="1"
                                        MouseLeftButtonUp="FiltersHeader_Click"
                                        Height="50">
                                        <DockPanel>
                                            <TextBlock x:Name="FiltersArrow"
                                                   Text="▼"
                                                   FontWeight="Bold"
                                                   Margin="0,0,10,0"
                                                   VerticalAlignment="Center"/>
                                            <TextBlock Text="Фильтры"
                                                   FontSize="14"
                                                   FontWeight="SemiBold"
                                                   VerticalAlignment="Center"/>
                                        </DockPanel>
                                    </Border>

                                    <Border x:Name="FiltersPanel"
                                        Background="#FAFAFA"
                                        BorderBrush="#DDD"
                                        BorderThickness="1"
                                        CornerRadius="12"
                                        Padding="15"
                                        Margin="0,10,0,0"
                                        Visibility="Collapsed">
                                        <StackPanel>
                                            <TextBlock Text="Период:" 
                                                       FontWeight="Medium"
                                                       Margin="0,0,0,8"/>

                                            <!-- Выровненные по центру ComboBox -->
                                            <StackPanel Orientation="Horizontal" 
                                                        HorizontalAlignment="Center" 
                                                        VerticalAlignment="Center">

                                                <!-- "От" группа -->
                                                <StackPanel Orientation="Horizontal" 
                                                            VerticalAlignment="Center"
                                                            Margin="0,0,10,0">
                                                    <TextBlock Text="От:" 
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,8,0"/>

                                                    <ComboBox x:Name="YearFromCombo" 
                                                              Width="80"
                                                              Background="White"
                                                              BorderBrush="#CCCCCC"
                                                              BorderThickness="1"
                                                              Padding="8"
                                                              VerticalAlignment="Center"
                                                              SelectionChanged="Filter_Changed"/>

                                                    <ComboBox x:Name="MonthFromCombo" 
                                                              Width="120"
                                                              Background="White"
                                                              BorderBrush="#CCCCCC"
                                                              BorderThickness="1"
                                                              Padding="8"
                                                              VerticalAlignment="Center"
                                                              Margin="10,0,0,0"
                                                              SelectionChanged="Filter_Changed"/>
                                                </StackPanel>

                                                <!-- Дефис между группами -->
                                                <TextBlock Text="—" 
                                                           FontSize="20"
                                                           FontWeight="Bold"
                                                           VerticalAlignment="Center"
                                                           Margin="10,0"/>

                                                <!-- "До" группа -->
                                                <StackPanel Orientation="Horizontal" 
                                                            VerticalAlignment="Center"
                                                            Margin="10,0,0,0">
                                                    <TextBlock Text="До:" 
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,8,0"/>

                                                    <ComboBox x:Name="YearToCombo" 
                                                              Width="80"
                                                              Background="White"
                                                              BorderBrush="#CCCCCC"
                                                              BorderThickness="1"
                                                              Padding="8"
                                                              VerticalAlignment="Center"
                                                              SelectionChanged="Filter_Changed"/>

                                                    <ComboBox x:Name="MonthToCombo" 
                                                              Width="120"
                                                              Background="White"
                                                              BorderBrush="#CCCCCC"
                                                              BorderThickness="1"
                                                              Padding="8"
                                                              VerticalAlignment="Center"
                                                              Margin="10,0,0,0"
                                                              SelectionChanged="Filter_Changed"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>

                                <!-- 3) Диаграмма с фиксированными размерами -->
                                <Grid Grid.Row="2" MinHeight="450">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="250"/>
                                    </Grid.ColumnDefinitions>

                                    <Border Grid.Column="0" 
                                            BorderBrush="#DDD" 
                                            BorderThickness="1" 
                                            CornerRadius="12" 
                                            Padding="12" 
                                            Background="White"
                                            Margin="0,0,10,0"
                                            Height="420">
                                        <!-- Фиксированная высота -->
                                        <Viewbox Stretch="Uniform" 
                                                 HorizontalAlignment="Center" 
                                                 VerticalAlignment="Center">
                                            <Canvas x:Name="PieCanvas"
                                                    Width="400" 
                                                Height="400"
                                                Background="Transparent"/>
                                        </Viewbox>
                                    </Border>

                                    <Border Grid.Column="1" 
                                            BorderBrush="#DDD" 
                                            BorderThickness="1" 
                                            CornerRadius="12" 
                                            Padding="12"
                                            Height="420">
                                        <!-- Фиксированная высота -->
                                        <StackPanel>
                                            <TextBlock Text="Месяц — количество — %" 
                                                   FontWeight="Bold" 
                                                   Margin="0,0,0,12"/>
                                            <ScrollViewer VerticalScrollBarVisibility="Auto" 
                                                          Height="380">
                                                <StackPanel x:Name="LegendPanel" />
                                            </ScrollViewer>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Grid>
                        </ScrollViewer>
                    </TabItem>

                    <!-- ВКЛАДКА 2 — ПО КАТЕГОРИЯМ -->
                    <TabItem Header="По категориям">
                        <ScrollViewer VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled"
                                      Padding="0">
                            <Grid Margin="12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <!-- Изменено с * на Auto -->
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Заголовок -->
                                <StackPanel Grid.Row="0" Margin="0,0,0,15">
                                    <TextBlock Text="Распределение заметок по категориям"
                                       FontSize="18" 
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center" />

                                    <StackPanel Orientation="Horizontal" 
                                                HorizontalAlignment="Center" 
                                                Margin="0,12,0,0">
                                        <TextBlock Text="Сортировка:" 
                                                   VerticalAlignment="Center" 
                                                   Margin="0,0,10,0"/>
                                        <ComboBox x:Name="CategorySortCombo" 
                                                  Width="250"
                                                  Background="White"
                                                  BorderBrush="#CCCCCC"
                                                  BorderThickness="1"
                                                  Padding="8"
                                                  SelectionChanged="CategorySortCombo_Changed">
                                            <ComboBoxItem Content="По убыванию (больше → меньше)" />
                                            <ComboBoxItem Content="По возрастанию (меньше → больше)" />
                                        </ComboBox>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Диаграмма с фиксированными размерами -->
                                <Grid Grid.Row="1" MinHeight="350">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="200"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Canvas для столбцов -->
                                    <Border Grid.Column="0" 
                                            BorderBrush="#DDD" 
                                            BorderThickness="1" 
                                            CornerRadius="12" 
                                            Padding="12" 
                                            Background="White"
                                            Margin="0,0,10,0"
                                            Height="320">
                                        <!-- Фиксированная высота -->
                                        <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                                                      VerticalScrollBarVisibility="Disabled" 
                                                      Height="300">
                                            <Canvas x:Name="CategoryBarCanvas" 
                                                    Background="Transparent" 
                                                    Height="300"/>
                                        </ScrollViewer>
                                    </Border>

                                    <!-- Легенда -->
                                    <Border Grid.Column="1" 
                                            BorderBrush="#DDD" 
                                            BorderThickness="1"
                                            CornerRadius="12" 
                                            Padding="12"
                                            Height="320">
                                        <!-- Фиксированная высота -->
                                        <StackPanel>
                                            <TextBlock Text="Категории" 
                                                       FontWeight="Bold" 
                                                       Margin="0,0,0,12"/>
                                            <ScrollViewer VerticalScrollBarVisibility="Auto" 
                                                          Height="280">
                                                <StackPanel x:Name="CategoryLegendPanel"/>
                                            </ScrollViewer>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Grid>
                        </ScrollViewer>
                    </TabItem>
                </TabControl>
            </Border>

            <!-- Нижняя панель -->
            <Border Grid.Row="2" 
                    Background="#F8F8F8" 
                    CornerRadius="0,0,15,15"
                    Margin="20,0,20,20"
                    Height="60"
                    Padding="10">
                <StackPanel Orientation="Horizontal" 
                            HorizontalAlignment="Center" 
                            VerticalAlignment="Center">
                    <Button Content="Закрыть" 
                            Width="120"
                            Height="35"
                            Background="GhostWhite"
                            Foreground="Black"
                            BorderBrush="#CCCCCC"
                            BorderThickness="1"
                            Click="CloseButton_Click"/>
                </StackPanel>
            </Border>
        </Grid>
    </Border>
</Window>