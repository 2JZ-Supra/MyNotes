# Техническое задание: Заметки

**Студент:** Сапронов Роман Андреевич

**Группа:** 2407сб2

---

## 1. Описание проекта

### 1.1 Название системы
Система управления личными заметками

### 1.2 Назначение
Система предназначена для хранения, редактирования и организации личных заметок пользователя. Пользователь может создавать и редактировать заметки, добавлять в избранные, а также менять тему приложения. Также пользователь может приобрести подписку для расширения функционала: разделение заметок на категории и возможность прикрепления файлов.

---

## 2. Функциональные требования

### 2.1 Основные функции системы

#### Функция 1: Создание заметки
- **Описание:** Пользователь может создать новую текстовую заметку, указав заголовок, текст, категорию. Автоматически записывается дата заметки.
- **Входные данные:** Заголовок, текст заметки, категория.
- **Результат:** Заметка сохранена в БД и отображается в списке.

#### Функция 2: Редактирование заметки
- **Описание:** Позволяет изменить содержимое существующей заметки.
- **Входные данные:** ID заметки, новые данные.
- **Результат:** Заметка обновлена в базе данных.

#### Функция 3: Удаление заметки
- **Описание:** Удаление выбранной пользователем заметки.
- **Входные данные:** ID заметки.
- **Результат:** Заметка удалена из базы данных.

#### Функция 4: Добавление в избранные
- **Описание:** Позволяет пользователю отметить заметку как избранную для быстрого доступа. Избранные заметки отображаются в отдельном разделе.
- **Входные данные:** ID заметки, действие пользователя.
- **Результат:** Заметка помечена как избранная или исключена из избранного. Состояние сохраняется в базе данных.

#### Функция 5: Управление категориями
- **Описание:** Позволяет пользователю создавать, редактировать и удалять собственные категории для организации заметок (например: "Работа", "Личное", "Учёба").
- **Входные данные:** Текст (для создания/редактирования), ID категории (для удаления).
- **Результат:** Новая категория добавлена, существующая отредактирована или удалена в базе данных. При удалении категории, заметки, связанные с ней, переходят в состояние "Без категории".

#### Функция 6: Прикрепление файла
- **Описание:** Позволяет прикреплять к заметке файлы (изображения, документы и др.). Файл копируется в специальную папку приложения для обеспечения целостности данных.
- **Входные данные:** ID заметки, файл из диалога выбора.
- **Результат:** Файл сохранён в папке приложения и связан с соответствующей заметкой.

#### Функция 7: Просмотр и удаление прикрепленного файла
- **Описание:** Позволяет просматривать список прикрепленных файлов непосредственно в форме редактирования заметки, открывать их для просмотра в связанной программе или удалять из заметки.
- **Входные данные:** ID заметки, действие пользователя (открыть/удалить файл).
- **Результат:** Файл открыт во внешней программе или удален из папки приложения и базы данных.

#### Функция 8: Оплата подписки
- **Описание:** Пользователь может оформить платную подписку (месячную или годовую), вводя данные банковской карты. Система проверяет карту, сохраняет информацию о платеже и, при успешной оплате, активирует доступ к дополнительным функциям.
- **Входные данные:** Выбранный тариф, номер карты, срок действия, CVV.
- **Результат:** Подписка активирована, запись о платеже создана в БД.

---

## 3. Структура базы данных

### Таблица 1: Notes (Заметки)

**Описание:** Хранит текстовые заметки, созданные пользователем.

**Поля:**
- Id (int, PK) — уникальный идентификатор заметки
- Title (string) — заголовок заметки
- Content (string) — основное содержание заметки
- CreatedAt (datetime) — дата и время создания
- IsFavorite (bool) — пометка "избранная" (true/false)
- CategoryId (int?, FK → Categories.Id) — категория заметки (nullable)

**Связи:**
- CategoryId → Categories.Id
- Один-ко-многим с таблицей Files (одна заметка может иметь несколько файлов)

### Таблица 2: Categories (Категории)

**Описание:** Хранит категории, созданные пользователем для группировки заметок.

**Поля:**
- Id (int, PK) — уникальный идентификатор категории
- Name (string) — название категории
- CreatedAt (datetime) — дата создания категории

**Связи:**
- Один-ко-многим с Notes (одна категория может быть у нескольких заметок)

### Таблица 3: Files (Файлы)

**Описание:** Хранит информацию о прикреплённых к заметкам файлах. Файлы физически хранятся в папке приложения.

**Поля:**
- Id (int, PK) — уникальный идентификатор файла
- NoteId (int, FK → Notes.Id) — ID заметки, к которой прикреплён файл
- FileName (string) — оригинальное имя файла
- StoredFileName (string) — уникальное имя файла в папке приложения
- UploadedAt (datetime) — дата загрузки файла

**Связи:**
- NoteId → Notes.Id

### Таблица 4: Payments (Платежи)

**Описание:** Хранит информацию о платежах пользователей за подписку.

**Поля:**
- Id (int, PK) — уникальный идентификатор платежа
- PaymentDate (datetime) — дата оплаты
- Tariff (string) — выбранный тариф (месячная, годовая)
- Amount (decimal) — сумма платежа
- IsSuccessful (bool) — статус успешности платежа
- SubscriptionEndDate (datetime) — дата окончания подписки

**Связи:**
Нет внешних ключей (если нет регистрации пользователя).

---

## 4. Основные формы приложения

#### Форма 1: MainWindow (Главная форма)

**Назначение:** Основное окно для просмотра и управления заметками.

**Элементы управления:**
- DataGrid — список всех заметок
- ComboBox (категории) — фильтрация по категории
- CheckBox (избранные) — отображение только избранных заметок
- Menu (Навигация) — доступ к формам "Создать", "Оплата", "Темы", "Управление категориями" и др.

**Действия:**
- Кнопка "Создать заметку" — открывает NoteEditWindow
- Кнопка "Редактировать" — открывает NoteEditWindow с выбранной заметкой
- Кнопка "Удалить" — удаляет выбранную заметку
- Кнопка "Оплатить подписку" — открывает PaymentWindow
- Кнопка "Управление категориями" — открывает CategoryManagerWindow (если подписка активна)
- Кнопка "Тема" — позволяет изменить тему приложения.

#### Форма 2: NoteEditWindow

**Назначение:** Создание или редактирование заметки.

**Элементы управления:**
- TextBox (Заголовок) — ввод заголовка
- TextBox (Содержание) — ввод текста заметки
- ComboBox (Категория) — выбор категории (если подписка активна)
- ListBox — список прикреплённых файлов (отображаются имена файлов)
- Button (Прикрепить файл) — открывает диалог выбора файла
- Button (Открыть файл) — открывает выбранный в ListBox файл во внешней программе (активна при выборе файла)
- Button (Удалить файл) — удаляет выбранный файл из заметки и из папки приложения (активна при выборе файла)

**Действия:**
- Кнопка "Сохранить" — сохраняет изменения
- Кнопка "Отмена" — закрывает окно без сохранения

#### Форма 3: CategoryManagerWindow

**Назначение:** Управление категориями (просмотр, создание, редактирование, удаление).

**Элементы управления:**
- ListBox — список существующих категорий
- TextBox (Название категории) — ввод названия новой или редактируемой категории
- Button (Создать) — создает новую категорию
- Button (Редактировать) — сохраняет изменения для выбранной в ListBox категории (активна при выборе категории)
- Button (Удалить) — удаляет выбранную категорию (активна при выборе категории). При удалении заметки этой категории становятся без категории.
- Button (Закрыть) — закрывает окно

#### Форма 4: PaymentWindow

**Назначение:** Оформление подписки.

**Элементы управления:**
- ComboBox (тариф) — выбор тарифа: "Месяц", "Год"
- TextBox (номер карты) — ввод номера карты
- TextBox (срок действия) — MM/YY
- TextBox (CVV) — код безопасности
- TextBlock — отображение стоимости

**Действия:**
- Кнопка "Оплатить" — обработка и сохранение платежа
- Кнопка "Отмена" — закрытие формы без оплаты

---

## 5. Схема переходов между формами

### При запуске приложения

1. **Запуск** → MainWindow (главная форма со списком заметок)

### Из MainWindow (Главная форма)

1. **Кнопка "Создать заметку"** → NoteEditWindow (режим создания)
2. **Кнопка "Редактировать" (при выборе заметки)** → NoteEditWindow (режим редактирования)
3. **Кнопка "Удалить"** → диалог подтверждения → удаление, остаёмся на MainWindow
4. **Кнопка "Управление категориями"** (если подписка активна) → CategoryManagerWindow
5. **Кнопка "Оплатить подписку"** → PaymentWindow
6. **Кнопка "Тема"** → смена темы приложения (без перехода на новую форму)

### Из NoteEditWindow (Создание/редактирование заметки)

1. **Кнопка "Сохранить"** → сохранение заметки → возврат на MainWindow (обновлённый список)
2. **Кнопка "Отмена"** → возврат на MainWindow без сохранения
3. **Кнопка "Прикрепить файл"** → Диалог выбора файла → файл копируется в папку приложения и привязывается к заметке.
4. **Кнопка "Открыть файл"** (при выборе файла в списке) → Запуск внешней программы для просмотра файла.
5. **Кнопка "Удалить файл"** (при выборе файла в списке) → Удаление файла из заметки и из папки приложения.

### Из CategoryManagerWindow (Управление категориями)

1. **Кнопка "Создать"** → сохранение новой категории → обновление списка в окне
2. **Кнопка "Редактировать"** → сохранение изменений категории → обновление списка в окне
3. **Кнопка "Удалить"** → диалог подтверждения → удаление категории → обновление списка в окне
4. **Кнопка "Закрыть"** → возврат на MainWindow

### Из PaymentWindow (Оформление подписки)

1. **Кнопка "Оплатить"**
    1.1. **Успешная оплата** → сообщение об успехе → возврат на MainWindow
    1.2. **Ошибка оплаты** → сообщение об ошибке → остаёмся в PaymentWindow
2. **Кнопка "Отмена"** → возврат на MainWindow